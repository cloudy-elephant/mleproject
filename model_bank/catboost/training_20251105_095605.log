2025-11-05 09:56:05,095 [INFO] ============================================================
2025-11-05 09:56:05,095 [INFO] CatBoost Gold Price Prediction - 开始训练
2025-11-05 09:56:05,095 [INFO] ============================================================
2025-11-05 09:56:05,096 [INFO] 
配置信息:
2025-11-05 09:56:05,096 [INFO]   数据路径: /opt/airflow/datamart/gold
2025-11-05 09:56:05,096 [INFO]   输出路径: /opt/airflow/model_bank/catboost
2025-11-05 09:56:05,097 [INFO]   训练范围: (2023, 2) - (2024, 4)
2025-11-05 09:56:05,098 [INFO]   OOT范围:  (2024, 5) - (2024, 9)
2025-11-05 09:56:05,098 [INFO] ============================================================
2025-11-05 09:56:05,098 [INFO] 开始读取黄金价格数据...
2025-11-05 09:56:05,099 [INFO] ============================================================
2025-11-05 09:56:05,099 [INFO] 
训练集: 2023-02 至 2024-04 (共15个月)
2025-11-05 09:56:05,099 [INFO] OOT集: 2024-05 至 2024-09 (共5个月)
2025-11-05 09:56:05,100 [INFO] 
读取训练集数据...
2025-11-05 09:56:05,100 [INFO] ------------------------------------------------------------
2025-11-05 09:56:05,111 [INFO]   ✓ gold_2023_02_01.csv: 233 条记录
2025-11-05 09:56:05,119 [INFO]   ✓ gold_2023_03_01.csv: 224 条记录
2025-11-05 09:56:05,127 [INFO]   ✓ gold_2023_04_01.csv: 228 条记录
2025-11-05 09:56:05,134 [INFO]   ✓ gold_2023_05_01.csv: 216 条记录
2025-11-05 09:56:05,141 [INFO]   ✓ gold_2023_06_01.csv: 214 条记录
2025-11-05 09:56:05,148 [INFO]   ✓ gold_2023_07_01.csv: 219 条记录
2025-11-05 09:56:05,156 [INFO]   ✓ gold_2023_08_01.csv: 239 条记录
2025-11-05 09:56:05,164 [INFO]   ✓ gold_2023_09_01.csv: 225 条记录
2025-11-05 09:56:05,170 [INFO]   ✓ gold_2023_10_01.csv: 215 条记录
2025-11-05 09:56:05,177 [INFO]   ✓ gold_2023_11_01.csv: 213 条记录
2025-11-05 09:56:05,185 [INFO]   ✓ gold_2023_12_01.csv: 219 条记录
2025-11-05 09:56:05,193 [INFO]   ✓ gold_2024_01_01.csv: 232 条记录
2025-11-05 09:56:05,201 [INFO]   ✓ gold_2024_02_01.csv: 217 条记录
2025-11-05 09:56:05,210 [INFO]   ✓ gold_2024_03_01.csv: 240 条记录
2025-11-05 09:56:05,220 [INFO]   ✓ gold_2024_04_01.csv: 230 条记录
2025-11-05 09:56:05,225 [INFO] 
训练集合并完成: 3,364 条记录
2025-11-05 09:56:05,226 [INFO] 
读取OOT集数据...
2025-11-05 09:56:05,226 [INFO] ------------------------------------------------------------
2025-11-05 09:56:05,235 [INFO]   ✓ gold_2024_05_01.csv: 210 条记录
2025-11-05 09:56:05,243 [INFO]   ✓ gold_2024_06_01.csv: 221 条记录
2025-11-05 09:56:05,251 [INFO]   ✓ gold_2024_07_01.csv: 231 条记录
2025-11-05 09:56:05,258 [INFO]   ✓ gold_2024_08_01.csv: 221 条记录
2025-11-05 09:56:05,266 [INFO]   ✓ gold_2024_09_01.csv: 216 条记录
2025-11-05 09:56:05,267 [INFO] 
OOT集合并完成: 1,099 条记录
2025-11-05 09:56:05,268 [INFO] 
============================================================
2025-11-05 09:56:05,268 [INFO] 数据加载完成!
2025-11-05 09:56:05,268 [INFO] ============================================================
2025-11-05 09:56:05,269 [INFO] 
训练集: 3,364 条 × 38 列
2025-11-05 09:56:05,269 [INFO] OOT集:  1,099 条 × 38 列
2025-11-05 09:56:05,271 [INFO] 
============================================================
2025-11-05 09:56:05,271 [INFO] 开始数据预处理...
2025-11-05 09:56:05,272 [INFO] ============================================================
2025-11-05 09:56:05,277 [INFO] ✓ 找到目标变量: Churn
2025-11-05 09:56:05,278 [INFO] ✓ 目标变量转换完成 (Yes/No -> 1/0)
2025-11-05 09:56:05,279 [INFO] 
目标变量分布:
2025-11-05 09:56:05,279 [INFO] Churn
0    3262
1    1201
Name: count, dtype: int64
2025-11-05 09:56:05,280 [INFO] 正样本比例: 26.91%
2025-11-05 09:56:05,281 [INFO] ✓ 已移除ID列: customerID
2025-11-05 09:56:05,286 [INFO] ✓ 日期特征提取完成: snapdate
2025-11-05 09:56:05,287 [INFO] ✓ 数值型缺失值填充完成
2025-11-05 09:56:05,293 [INFO] ✓ 类别型缺失值填充完成
2025-11-05 09:56:05,293 [INFO] 
------------------------------------------------------------
2025-11-05 09:56:05,294 [INFO] 识别和处理类别特征...
2025-11-05 09:56:05,294 [INFO] ------------------------------------------------------------
2025-11-05 09:56:05,299 [INFO] ✓ 识别到 27 个类别特征
2025-11-05 09:56:05,299 [INFO] 类别特征: ['Contract', 'PaperlessBilling', 'PaymentMethod', 'AutoRenewal', 'BillingCycle', 'DiscountApplied', 'LoyaltyProgramMember', 'PhoneService', 'MultipleLines', 'InternetService']...
2025-11-05 09:56:05,299 [INFO] 
✓ 数据预处理完成，当前数据维度: (4463, 39)
2025-11-05 09:56:05,300 [INFO] 
============================================================
2025-11-05 09:56:05,300 [INFO] 准备训练数据...
2025-11-05 09:56:05,300 [INFO] ============================================================
2025-11-05 09:56:05,306 [INFO] 
时间范围分布:
2025-11-05 09:56:05,306 [INFO]   训练+验证集: 3364 条
2025-11-05 09:56:05,307 [INFO]   OOT集: 2018 条
2025-11-05 09:56:05,311 [INFO] 
最终划分:
2025-11-05 09:56:05,311 [INFO]   训练集: (2691, 35)
2025-11-05 09:56:05,312 [INFO]   验证集: (673, 35)
2025-11-05 09:56:05,312 [INFO]   OOT集: (2018, 35)
2025-11-05 09:56:05,313 [INFO] 
类别特征索引: 27 个
2025-11-05 09:56:05,313 [INFO] 
============================================================
2025-11-05 09:56:05,313 [INFO] 训练CatBoost模型...
2025-11-05 09:56:05,314 [INFO] ============================================================
2025-11-05 09:56:05,314 [INFO] 模型配置:
2025-11-05 09:56:05,314 [INFO]   - iterations: 1000
2025-11-05 09:56:05,314 [INFO]   - learning_rate: 0.03
2025-11-05 09:56:05,315 [INFO]   - depth: 6
2025-11-05 09:56:05,315 [INFO]   - cat_features: 27 个
2025-11-05 09:56:05,315 [INFO] 
开始训练...
2025-11-05 09:56:05,315 [INFO] ------------------------------------------------------------
2025-11-05 09:56:07,682 [INFO] 
✓ 模型训练完成！
2025-11-05 09:56:07,682 [INFO] ✓ 最佳迭代次数: 286
2025-11-05 09:56:07,682 [INFO] ✓ 最佳验证AUC: 0.8305
2025-11-05 09:56:07,682 [INFO] 
============================================================
2025-11-05 09:56:07,683 [INFO] 模型评估...
2025-11-05 09:56:07,683 [INFO] ============================================================
2025-11-05 09:56:07,693 [INFO] 
验证集评估:
2025-11-05 09:56:07,694 [INFO] ============================================================
2025-11-05 09:56:07,699 [INFO] 
              precision    recall  f1-score   support

           0       0.91      0.70      0.79       489
           1       0.50      0.81      0.62       184

    accuracy                           0.73       673
   macro avg       0.71      0.75      0.71       673
weighted avg       0.80      0.73      0.74       673

2025-11-05 09:56:07,702 [INFO] 
核心指标:
2025-11-05 09:56:07,702 [INFO]   Accuracy: 0.7296
2025-11-05 09:56:07,703 [INFO]   AUC-ROC:  0.8305
2025-11-05 09:56:07,703 [INFO] 
============================================================
2025-11-05 09:56:07,703 [INFO] OOT集评估:
2025-11-05 09:56:07,704 [INFO] ============================================================
2025-11-05 09:56:07,731 [INFO] 
              precision    recall  f1-score   support

           0       0.92      0.73      0.81      1488
           1       0.51      0.82      0.63       530

    accuracy                           0.75      2018
   macro avg       0.72      0.77      0.72      2018
weighted avg       0.81      0.75      0.76      2018

2025-11-05 09:56:07,734 [INFO] 
核心指标:
2025-11-05 09:56:07,734 [INFO]   Accuracy: 0.7498
2025-11-05 09:56:07,734 [INFO]   AUC-ROC:  0.8569
2025-11-05 09:56:07,735 [INFO] 
模型稳定性 (PSI): 0.0146
2025-11-05 09:56:07,735 [INFO]   ✓ PSI < 0.1: 模型稳定性良好
2025-11-05 09:56:07,735 [INFO] 
============================================================
2025-11-05 09:56:07,735 [INFO] 保存模型和结果...
2025-11-05 09:56:07,735 [INFO] ============================================================
2025-11-05 09:56:07,757 [INFO] ✓ 模型已保存: /opt/airflow/model_bank/catboost/catboost_gold_model.cbm
2025-11-05 09:56:07,766 [INFO] ✓ 特征重要性已保存: /opt/airflow/model_bank/catboost/feature_importance.csv
2025-11-05 09:56:07,771 [INFO] ✓ 预测结果已保存: /opt/airflow/model_bank/catboost/predictions.csv
2025-11-05 09:56:07,774 [INFO] ✓ 评估指标已保存: /opt/airflow/model_bank/catboost/model_metrics.csv
2025-11-05 09:56:07,775 [INFO] 
============================================================
2025-11-05 09:56:07,775 [INFO] ✅ 所有结果已保存!
2025-11-05 09:56:07,775 [INFO] ============================================================
2025-11-05 09:56:07,775 [INFO] 
============================================================
2025-11-05 09:56:07,775 [INFO] ✅ 训练流程全部完成！
2025-11-05 09:56:07,775 [INFO] ============================================================
2025-11-05 09:56:07,776 [INFO] 
生成的文件位于: /opt/airflow/model_bank/catboost
2025-11-05 09:56:07,776 [INFO] 
模型加载示例:
2025-11-05 09:56:07,777 [INFO]   from catboost import CatBoostClassifier
2025-11-05 09:56:07,777 [INFO]   model = CatBoostClassifier()
2025-11-05 09:56:07,777 [INFO]   model.load_model('/opt/airflow/model_bank/catboost/catboost_gold_model.cbm')
