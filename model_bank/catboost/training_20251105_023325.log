2025-11-05 02:33:25,999 [INFO] ============================================================
2025-11-05 02:33:25,999 [INFO] CatBoost Gold Price Prediction - 开始训练
2025-11-05 02:33:25,999 [INFO] ============================================================
2025-11-05 02:33:25,999 [INFO] 
配置信息:
2025-11-05 02:33:25,999 [INFO]   数据路径: ./datamart/gold
2025-11-05 02:33:25,999 [INFO]   输出路径: ./model_bank/catboost
2025-11-05 02:33:26,000 [INFO]   训练范围: (2023, 2) - (2024, 4)
2025-11-05 02:33:26,000 [INFO]   OOT范围:  (2024, 5) - (2024, 9)
2025-11-05 02:33:26,000 [INFO] ============================================================
2025-11-05 02:33:26,000 [INFO] 开始读取黄金价格数据...
2025-11-05 02:33:26,000 [INFO] ============================================================
2025-11-05 02:33:26,000 [INFO] 
训练集: 2023-02 至 2024-04 (共15个月)
2025-11-05 02:33:26,000 [INFO] OOT集: 2024-05 至 2024-09 (共5个月)
2025-11-05 02:33:26,000 [INFO] 
读取训练集数据...
2025-11-05 02:33:26,000 [INFO] ------------------------------------------------------------
2025-11-05 02:33:26,012 [INFO]   ✓ gold_2023_02_01.csv: 233 条记录
2025-11-05 02:33:26,015 [INFO]   ✓ gold_2023_03_01.csv: 224 条记录
2025-11-05 02:33:26,018 [INFO]   ✓ gold_2023_04_01.csv: 228 条记录
2025-11-05 02:33:26,021 [INFO]   ✓ gold_2023_05_01.csv: 216 条记录
2025-11-05 02:33:26,024 [INFO]   ✓ gold_2023_06_01.csv: 214 条记录
2025-11-05 02:33:26,026 [INFO]   ✓ gold_2023_07_01.csv: 219 条记录
2025-11-05 02:33:26,029 [INFO]   ✓ gold_2023_08_01.csv: 239 条记录
2025-11-05 02:33:26,032 [INFO]   ✓ gold_2023_09_01.csv: 225 条记录
2025-11-05 02:33:26,036 [INFO]   ✓ gold_2023_10_01.csv: 215 条记录
2025-11-05 02:33:26,039 [INFO]   ✓ gold_2023_11_01.csv: 213 条记录
2025-11-05 02:33:26,042 [INFO]   ✓ gold_2023_12_01.csv: 219 条记录
2025-11-05 02:33:26,045 [INFO]   ✓ gold_2024_01_01.csv: 232 条记录
2025-11-05 02:33:26,049 [INFO]   ✓ gold_2024_02_01.csv: 217 条记录
2025-11-05 02:33:26,052 [INFO]   ✓ gold_2024_03_01.csv: 240 条记录
2025-11-05 02:33:26,055 [INFO]   ✓ gold_2024_04_01.csv: 230 条记录
2025-11-05 02:33:26,057 [INFO] 
训练集合并完成: 3,364 条记录
2025-11-05 02:33:26,057 [INFO] 
读取OOT集数据...
2025-11-05 02:33:26,057 [INFO] ------------------------------------------------------------
2025-11-05 02:33:26,060 [INFO]   ✓ gold_2024_05_01.csv: 210 条记录
2025-11-05 02:33:26,063 [INFO]   ✓ gold_2024_06_01.csv: 221 条记录
2025-11-05 02:33:26,067 [INFO]   ✓ gold_2024_07_01.csv: 231 条记录
2025-11-05 02:33:26,070 [INFO]   ✓ gold_2024_08_01.csv: 221 条记录
2025-11-05 02:33:26,073 [INFO]   ✓ gold_2024_09_01.csv: 216 条记录
2025-11-05 02:33:26,073 [INFO] 
OOT集合并完成: 1,099 条记录
2025-11-05 02:33:26,074 [INFO] 
============================================================
2025-11-05 02:33:26,074 [INFO] 数据加载完成!
2025-11-05 02:33:26,074 [INFO] ============================================================
2025-11-05 02:33:26,074 [INFO] 
训练集: 3,364 条 × 38 列
2025-11-05 02:33:26,074 [INFO] OOT集:  1,099 条 × 38 列
2025-11-05 02:33:26,074 [INFO] 
============================================================
2025-11-05 02:33:26,074 [INFO] 开始数据预处理...
2025-11-05 02:33:26,074 [INFO] ============================================================
2025-11-05 02:33:26,076 [INFO] ✓ 找到目标变量: Churn
2025-11-05 02:33:26,079 [INFO] ✓ 目标变量转换完成 (Yes/No -> 1/0)
2025-11-05 02:33:26,079 [INFO] 
目标变量分布:
2025-11-05 02:33:26,081 [INFO] Churn
0    3262
1    1201
Name: count, dtype: int64
2025-11-05 02:33:26,081 [INFO] 正样本比例: 26.91%
2025-11-05 02:33:26,083 [INFO] ✓ 已移除ID列: customerID
2025-11-05 02:33:26,091 [INFO] ✓ 日期特征提取完成: snapdate
2025-11-05 02:33:26,093 [INFO] ✓ 数值型缺失值填充完成
2025-11-05 02:33:26,099 [INFO] ✓ 类别型缺失值填充完成
2025-11-05 02:33:26,099 [INFO] 
------------------------------------------------------------
2025-11-05 02:33:26,099 [INFO] 识别和处理类别特征...
2025-11-05 02:33:26,099 [INFO] ------------------------------------------------------------
2025-11-05 02:33:26,104 [INFO] ✓ 识别到 27 个类别特征
2025-11-05 02:33:26,104 [INFO] 类别特征: ['Contract', 'PaperlessBilling', 'PaymentMethod', 'AutoRenewal', 'BillingCycle', 'DiscountApplied', 'LoyaltyProgramMember', 'PhoneService', 'MultipleLines', 'InternetService']...
2025-11-05 02:33:26,104 [INFO] 
✓ 数据预处理完成，当前数据维度: (4463, 39)
2025-11-05 02:33:26,104 [INFO] 
============================================================
2025-11-05 02:33:26,104 [INFO] 准备训练数据...
2025-11-05 02:33:26,104 [INFO] ============================================================
2025-11-05 02:33:26,111 [INFO] 
时间范围分布:
2025-11-05 02:33:26,111 [INFO]   训练+验证集: 3364 条
2025-11-05 02:33:26,111 [INFO]   OOT集: 2018 条
2025-11-05 02:33:26,116 [INFO] 
最终划分:
2025-11-05 02:33:26,116 [INFO]   训练集: (2691, 35)
2025-11-05 02:33:26,116 [INFO]   验证集: (673, 35)
2025-11-05 02:33:26,117 [INFO]   OOT集: (2018, 35)
2025-11-05 02:33:26,117 [INFO] 
类别特征索引: 27 个
2025-11-05 02:33:26,117 [INFO] 
============================================================
2025-11-05 02:33:26,117 [INFO] 训练CatBoost模型...
2025-11-05 02:33:26,117 [INFO] ============================================================
2025-11-05 02:33:26,117 [INFO] 模型配置:
2025-11-05 02:33:26,117 [INFO]   - iterations: 1000
2025-11-05 02:33:26,117 [INFO]   - learning_rate: 0.03
2025-11-05 02:33:26,117 [INFO]   - depth: 6
2025-11-05 02:33:26,117 [INFO]   - cat_features: 27 个
2025-11-05 02:33:26,117 [INFO] 
开始训练...
2025-11-05 02:33:26,118 [INFO] ------------------------------------------------------------
2025-11-05 02:33:39,099 [INFO] 
✓ 模型训练完成！
2025-11-05 02:33:39,099 [INFO] ✓ 最佳迭代次数: 286
2025-11-05 02:33:39,099 [INFO] ✓ 最佳验证AUC: 0.8305
2025-11-05 02:33:39,099 [INFO] 
============================================================
2025-11-05 02:33:39,099 [INFO] 模型评估...
2025-11-05 02:33:39,099 [INFO] ============================================================
2025-11-05 02:33:39,115 [INFO] 
验证集评估:
2025-11-05 02:33:39,117 [INFO] ============================================================
2025-11-05 02:33:39,122 [INFO] 
              precision    recall  f1-score   support

           0       0.91      0.70      0.79       489
           1       0.50      0.81      0.62       184

    accuracy                           0.73       673
   macro avg       0.71      0.75      0.71       673
weighted avg       0.80      0.73      0.74       673

2025-11-05 02:33:39,126 [INFO] 
核心指标:
2025-11-05 02:33:39,126 [INFO]   Accuracy: 0.7296
2025-11-05 02:33:39,126 [INFO]   AUC-ROC:  0.8305
2025-11-05 02:33:39,126 [INFO] 
============================================================
2025-11-05 02:33:39,126 [INFO] OOT集评估:
2025-11-05 02:33:39,126 [INFO] ============================================================
2025-11-05 02:33:39,170 [INFO] 
              precision    recall  f1-score   support

           0       0.92      0.73      0.81      1488
           1       0.51      0.82      0.63       530

    accuracy                           0.75      2018
   macro avg       0.72      0.77      0.72      2018
weighted avg       0.81      0.75      0.76      2018

2025-11-05 02:33:39,173 [INFO] 
核心指标:
2025-11-05 02:33:39,173 [INFO]   Accuracy: 0.7498
2025-11-05 02:33:39,173 [INFO]   AUC-ROC:  0.8569
2025-11-05 02:33:39,173 [INFO] 
模型稳定性 (PSI): 0.0147
2025-11-05 02:33:39,173 [INFO]   ✓ PSI < 0.1: 模型稳定性良好
2025-11-05 02:33:39,173 [INFO] 
============================================================
2025-11-05 02:33:39,173 [INFO] 保存模型和结果...
2025-11-05 02:33:39,173 [INFO] ============================================================
2025-11-05 02:33:39,177 [INFO] ✓ 模型已保存: ./model_bank/catboost\catboost_gold_model.cbm
2025-11-05 02:33:39,187 [INFO] ✓ 特征重要性已保存: ./model_bank/catboost\feature_importance.csv
2025-11-05 02:33:39,190 [INFO] ✓ 预测结果已保存: ./model_bank/catboost\predictions.csv
2025-11-05 02:33:39,191 [INFO] ✓ 评估指标已保存: ./model_bank/catboost\model_metrics.csv
2025-11-05 02:33:39,191 [INFO] 
生成可视化图表...
2025-11-05 02:33:40,028 [INFO] ✓ 特征重要性图已保存: ./model_bank/catboost\feature_importance.png
2025-11-05 02:33:40,028 [INFO] 
============================================================
2025-11-05 02:33:40,028 [INFO] ✅ 所有结果已保存!
2025-11-05 02:33:40,028 [INFO] ============================================================
2025-11-05 02:33:40,028 [INFO] 
============================================================
2025-11-05 02:33:40,028 [INFO] ✅ 训练流程全部完成！
2025-11-05 02:33:40,028 [INFO] ============================================================
2025-11-05 02:33:40,028 [INFO] 
生成的文件位于: ./model_bank/catboost
2025-11-05 02:33:40,028 [INFO] 
模型加载示例:
2025-11-05 02:33:40,028 [INFO]   from catboost import CatBoostClassifier
2025-11-05 02:33:40,028 [INFO]   model = CatBoostClassifier()
2025-11-05 02:33:40,028 [INFO]   model.load_model('./model_bank/catboost\catboost_gold_model.cbm')
